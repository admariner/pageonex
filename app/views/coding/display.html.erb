<h1>Display: <%= @thread.thread_display_name.capitalize %></h1>
<hr>

<div class="row">
	<div class="span4">
		<h3>Name:</h3> <p><%= @thread.thread_display_name %></p>
		<h3>Description:</h3><p> <%= @thread.description %></p>
		<h3>Category:</h3> <p><%= @thread.category %></p>
		<h3>Status:</h3> <p><%= @thread.status %></p>
		
		<p><h4>From:</h4> <%= @thread.start_date.inspect %></p>
		<p><h4>To:</h4> <%= @thread.end_date.inspect %></p>
		
		
	</div>
	<div class="span5">
		<h3>Topics coded</h3>
			<% @thread.codes.each do |code| %>
        <div id="code-<%= code.id %>" style="background-color:<%= code.color %>; margin-left: 7px; float: left;color:black" class="alert alert-info">
            <p ><h4><%= code.code_text %></h4>
                <br>
                <%= code.code_description %>
            </p>
        </div>
       <% end %>
	</div>
</div> 
<hr>
<div class="row"></div>
	<!--<h3>Percentage of surface</h3> That will be when we have the bar chart-->
	<h3>Surface in Newspapers front pages</h3>
	<p>Export to svg, csv, ods, png, pdf</p>
<hr>

<div class="row">
	<div class="span3">
		<h2>Newspapers:</h2>
	</div>
	
</div>

<hr>


	<% @thread.media.each do |m| %>
		<div class="row">
			<div class="span3">
				<div class="alert alert-info">
  				<h2><%= m.display_name %></h2>
				</div>
			</div>
		</div>
		<div class="row images">
			<% images_counter = @thread.images.length %>
			<% 0.upto(images_counter-1) do |ic| %>
				<% if @thread.images[ic].media == m  %>
					<div class="span3 <%= "thum_image#{ic+1}" %>">
	          <%= image_tag "/assets#{@thread.images[ic].local_path}", id: "image#{ic+1}", style: "height:320px;opacity: 0.8;"%>

	          <div id="<%= "high_area#{ic+1}" %>" style="position: absolute; overflow: hidden; z-index: 0; left: 0px; top: 0px; width: 0px; height: 0px; display: block; opacity: 0.7;" class="imgareaselect-outer"></div>
					</div>
				<% end %>
			
			<% end %>
		</div>
			<hr>
	<% end %>

	<div id="high_areas">
		<% @highlighted_areas.each do |ha| %>
	    <div id="image<%= ha.name[5] %>">
	        <%= hidden_field_tag ha.name,"1" %>
	        <%= hidden_field_tag "#{ha.name}_code_id", "#{ha.code.id}" %>
	        <%= hidden_field_tag "#{ha.name}_x1", ha.areas[0].x1 %>
	        <%= hidden_field_tag "#{ha.name}_y1",ha.areas[0].y1 %>
	        <%= hidden_field_tag "#{ha.name}_x2",ha.areas[0].x2 %>
	        <%= hidden_field_tag "#{ha.name}_y2",ha.areas[0].y2 %>
	        <%= hidden_field_tag "#{ha.name}_width", ha.areas[0].width%>
	        <%= hidden_field_tag "#{ha.name}_height", ha.areas[0].height%>
	    </div>
	  <% end %>
  </div>

	
<script type="text/javascript">
$(document).ready(function () {
	
	high_areas = $("#high_areas div")

	for (var i = high_areas.length -1; i >= 0; i--) {
			c_high_area_id = $(high_areas[i]).attr("id").substr(5)
			high_area = $("div.images").find("div#high_area"+c_high_area_id)

			c_image = $("img#image"+c_high_area_id)

			ratio = 949/320

			// assume it render only one highlighted area
			curr_high_area_code = $("#image"+c_high_area_id+"_ha1"+"_code_id").attr("value")
			high_area.css("background-color", $("#code-"+curr_high_area_code).css("background-color"))

			_top = parseFloat($("#image"+c_high_area_id+"_ha"+"1"+"_y1").attr("value")) / ratio
			_top = _top + c_image.position().top
			high_area.css("top", _top + "px" )

			_left = parseFloat($("#image"+c_high_area_id+"_ha"+"1"+"_x1").attr("value")) / ratio
			_left = _left + c_image.position().left
			high_area.css("left", _left + "px")

			_width = parseFloat($("#image"+c_high_area_id+"_ha"+"1"+"_width").attr("value")) / ratio
			high_area.css("width", _width + "px")

			_height = parseFloat($("#image"+c_high_area_id+"_ha"+"1"+"_height").attr("value")) / ratio
			high_area.css("height", _height + "px")

	};


// images = $(".images img")

// 	for (var i = images.length -1; i >= 0; i--) {
// 		if ( $(images[i]) != undefined ){
// 			c_image = $(images[i])

// 			ratio = 949/320

// 			c_img_id = c_image.attr("id").substr(5)
			
// 			high_area = $('#high_area' + c_img_id);
// 			curr_high_area_code = $("#image"+c_img_id+"_ha"+c_img_id+"_code_id").attr("value")
// 			high_area.css("background-color", $("#code-"+curr_high_area_code).css("background-color"))

// 			_top = parseFloat($("#image"+c_img_id+"_ha"+c_img_id+"_y1").attr("value")) / ratio
// 			_top = _top + c_image.position().top
// 			high_area.css("top", _top + "px" )

// 			_left = parseFloat($("#image"+c_img_id+"_ha"+c_img_id+"_x1").attr("value")) / ratio
// 			_left = _left + c_image.position().left
// 			high_area.css("left", _left + "px")

// 			_width = parseFloat($("#image"+c_img_id+"_ha"+c_img_id+"_width").attr("value")) / ratio
// 			high_area.css("width", _width + "px")

// 			_height = parseFloat($("#image"+c_img_id+"_ha"+c_img_id+"_height").attr("value")) / ratio
// 			high_area.css("height", _height + "px")
// 		};

// 	};

	

})


</script>


<script type="text/javascript">
$(function (argument) {
    $(".breadcrumb li").filter("li.active").attr("class"," ");
    $("#display").attr("class", "active");

})
</script>

